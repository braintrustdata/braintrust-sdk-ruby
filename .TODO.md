# Braintrust Ruby SDK - TODO

> See `.DONE.md` for completed work

## Known Issues / Tech Debt

### High Priority

- [x] **SSL Certificate Verification on macOS**: ✅ FIXED (2025-10-22)
  - **Solution**: Added `openssl` gem v3.3.1+ as runtime dependency
  - Fixed in Ruby/OpenSSL maintainers' release (see https://github.com/ruby/openssl/issues/949)
  - Removed all `VERIFY_NONE` workarounds and ssl_config.rb
  - Now uses proper SSL verification with VERIFY_PEER
  - Tests passing, SSL connections verified working

### Medium Priority

- [ ] **Kitchen-Sink Span Export Inconsistency**: Some eval runs show incomplete span export
  - Affects: examples/internal/kitchen-sink.rb (8 cases, only 3-4 appear sometimes)
  - Issue: BatchSpanProcessor may not flush all spans before shutdown
  - Simple evals work fine (3 cases exported successfully)
  - May need explicit `tracer_provider.force_flush()` before `shutdown()`
  - May be timing-related with concurrent OpenAI API calls

### Low Priority

- [ ] **Parallelism Not Implemented**: Eval.run accepts parallelism parameter but doesn't use it
  - Currently runs cases sequentially
  - Need to implement parallel execution with threads or concurrent-ruby

## Pending Work

### Phase 2: Deferred Items
- [ ] Implement Braintrust.with_state (deferred - not needed yet)
- [ ] Implement State#login_until_success (deferred - background thread with retries)

### Phase 3: Trace Utilities (Deferred)
- [ ] Write test: permalink generation
- [ ] Implement Trace.permalink
- [ ] Implement Trace.set_parent (for setting parent in context)
- [ ] Implement Trace.get_parent
- [ ] Implement span filtering logic (AI spans filter)

### Phase 4.5: OpenAI Advanced Features (Future)

#### Streaming Support
- [ ] Add support for `stream_raw` API
- [ ] Handle streaming responses and chunks
- [ ] Aggregate streaming data for tracing
- [ ] Test streaming with console output

#### Additional Endpoints
- [ ] Embeddings support
- [ ] Assistants API support
- [ ] Fine-tuning API support
- [ ] Images API support

#### Error Handling & Reliability
- [ ] Better error handling for API failures
- [ ] Retry logic with exponential backoff
- [ ] Timeout configuration
- [ ] Rate limiting handling

### Phase 5: API Client (TDD)

#### lib/braintrust/api.rb
- [ ] Write test: register_project creates/fetches project
- [ ] Write test: register_experiment creates experiment
- [ ] Write test: register_experiment with update flag
- [ ] Write test: create_dataset creates dataset
- [ ] Write test: fetch_dataset fetches dataset
- [ ] Write test: insert_dataset_events inserts events
- [ ] Write test: API with explicit state
- [ ] Write test: API with global state
- [ ] Implement API class
- [ ] Implement register_project
- [ ] Implement register_experiment
- [ ] Implement create_dataset
- [ ] Implement fetch_dataset
- [ ] Implement insert_dataset_events

### Phase 6: Evals - Remaining Items

#### lib/braintrust/eval.rb
- [ ] Implement parallel execution (parallelism parameter)

#### lib/braintrust/eval/dataset.rb
- [ ] Write test: Dataset enumerable
- [ ] Write test: Dataset from array
- [ ] Write test: Dataset from API
- [ ] Implement Dataset class

### Phase 7: Examples

#### examples/openai/
- [ ] Create openai_basic.rb
- [ ] Test example runs successfully

#### examples/otel/
- [ ] Create otel_basic.rb
- [ ] Test example runs successfully

#### examples/evals/
- [ ] Create eval_basic.rb
- [ ] Test example runs successfully

### Phase 8: Documentation & Polish

- [ ] Write comprehensive README.md
- [ ] Document all public APIs
- [ ] Add inline code comments
- [ ] Update CONTRIBUTING.md
- [ ] Update CHANGELOG.md
- [ ] Verify 80%+ test coverage
- [ ] Run Standard linter and fix issues
- [ ] Set up CI/CD pipeline
- [ ] Tag v0.1.0 release

## Current Status

**Last Updated**: 2025-10-22 (Session 4)
**Current Phase**: Phase 6 (Evals Framework) - ✅ MOSTLY COMPLETE (Error Handling ✅, Parallelism pending)
**Test Status**: 72 test runs, 243 assertions, all passing, linter clean

## Outstanding Issues Summary

**Session 4 Completed**:
- ✅ Error handling complete (task errors, scorer errors, stacktraces)
- ✅ All tests passing
- ⚠️ Kitchen-sink inconsistency (span export timing issue)

## Next Session Options

1. **Fix SSL Certificate Verification** (High Priority ⚠️)
   - Security issue that needs resolution
   - Investigate proper cert store configuration

2. **Fix Kitchen-Sink Span Export** (Medium Priority)
   - Add explicit force_flush() before shutdown
   - Test with larger eval runs

3. **Implement Parallelism** (Low Priority)
   - Add parallel case execution to Eval.run

4. **API Client** (Phase 5)
   - Datasets API support

5. **OpenAI Advanced** (Phase 4.5)
   - Streaming support
