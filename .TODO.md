# Braintrust Ruby SDK - Implementation Checklist

## Phase 0: Documentation ✅

- [x] Create PLAN.md
- [x] Create TODO.md

## Phase 1: Project Setup & Infrastructure ✅

- [x] Create braintrust.gemspec
- [x] Create Gemfile
- [x] Create Rakefile
- [x] Create mise.toml with precommit hooks
- [x] Create .env.example
- [x] Create .github/workflows/ci.yml
- [x] Set up Standard linter config (via Rakefile)
- [x] Set up SimpleCov config (via test_helper.rb)
- [x] Create basic README.md
- [x] Create .gitignore
- [x] Create CHANGELOG.md
- [x] Create lib/braintrust/version.rb
- [x] Create lib/braintrust.rb (skeleton)
- [x] Create test/test_helper.rb

## Phase 2: Core State & Configuration (TDD)

### lib/braintrust/config.rb
- [ ] Write test: parse ENV vars
- [ ] Write test: default values
- [ ] Write test: merge options with ENV vars
- [ ] Implement Config.from_env
- [ ] Implement Config.merge

### lib/braintrust/state.rb
- [ ] Write test: create state with required fields
- [ ] Write test: validate required fields
- [ ] Write test: state is immutable
- [ ] Write test: thread-safe global state access
- [ ] Implement State class
- [ ] Implement State.global getter/setter
- [ ] Implement State validation

### lib/braintrust.rb
- [ ] Write test: init sets global state by default
- [ ] Write test: init with set_global: false returns state
- [ ] Write test: current_state returns global state
- [ ] Write test: with_state temporarily overrides global
- [ ] Implement Braintrust.init
- [ ] Implement Braintrust.current_state
- [ ] Implement Braintrust.with_state

## Phase 3: Core Tracing (TDD)

### lib/braintrust/trace/span_processor.rb
- [ ] Write test: adds braintrust.parent attribute
- [ ] Write test: adds braintrust.org attribute
- [ ] Write test: adds braintrust.app_url attribute
- [ ] Write test: resolves parent from context
- [ ] Write test: filters non-AI spans when configured
- [ ] Write test: thread-safe span processing
- [ ] Implement SpanProcessor class
- [ ] Implement on_start hook
- [ ] Implement on_end hook
- [ ] Implement span filtering logic

### lib/braintrust/trace.rb
- [ ] Write test: enable creates tracer provider
- [ ] Write test: enable configures OTLP exporter
- [ ] Write test: enable registers span processor
- [ ] Write test: enable with explicit state
- [ ] Write test: enable with global state
- [ ] Write test: disable/teardown cleans up
- [ ] Write test: permalink generation
- [ ] Implement Trace.enable
- [ ] Implement Trace.disable
- [ ] Implement Trace.permalink
- [ ] Implement Trace.set_parent
- [ ] Implement Trace.get_parent

## Phase 4: OpenAI Integration (TDD)

### lib/braintrust/trace/openai.rb
- [ ] Write test: middleware creates span for chat.completions
- [ ] Write test: middleware records request attributes
- [ ] Write test: middleware records response attributes
- [ ] Write test: middleware parses token usage
- [ ] Write test: middleware with explicit state
- [ ] Write test: middleware with global state
- [ ] Write test: middleware handles errors
- [ ] Implement OpenAI.middleware
- [ ] Implement request span creation
- [ ] Implement response attribute recording
- [ ] Implement token usage parsing
- [ ] Implement gen_ai.* semantic conventions

## Phase 5: API Client (TDD)

### lib/braintrust/api.rb
- [ ] Write test: register_project creates/fetches project
- [ ] Write test: register_experiment creates experiment
- [ ] Write test: register_experiment with update flag
- [ ] Write test: create_dataset creates dataset
- [ ] Write test: fetch_dataset fetches dataset
- [ ] Write test: insert_dataset_events inserts events
- [ ] Write test: API with explicit state
- [ ] Write test: API with global state
- [ ] Implement API class
- [ ] Implement register_project
- [ ] Implement register_experiment
- [ ] Implement create_dataset
- [ ] Implement fetch_dataset
- [ ] Implement insert_dataset_events

## Phase 6: Evals Framework (TDD)

### lib/braintrust/eval/case.rb
- [ ] Write test: Case with input/expected
- [ ] Write test: Case with tags and metadata
- [ ] Implement Case class

### lib/braintrust/eval/scorer.rb
- [ ] Write test: Scorer interface
- [ ] Write test: Scorer helper with block
- [ ] Write test: Scorer returns score
- [ ] Implement Scorer module/class
- [ ] Implement Eval.scorer helper

### lib/braintrust/eval/dataset.rb
- [ ] Write test: Dataset enumerable
- [ ] Write test: Dataset from array
- [ ] Write test: Dataset from API
- [ ] Implement Dataset class

### lib/braintrust/eval.rb
- [ ] Write test: run with cases array
- [ ] Write test: run resolves project
- [ ] Write test: run resolves experiment
- [ ] Write test: run executes task for each case
- [ ] Write test: run executes scorers
- [ ] Write test: run creates OTEL spans
- [ ] Write test: run with parallelism
- [ ] Write test: run with explicit state
- [ ] Write test: run with global state
- [ ] Write test: run handles task errors
- [ ] Write test: run handles scorer errors
- [ ] Implement Eval.run
- [ ] Implement project resolution
- [ ] Implement experiment resolution
- [ ] Implement task execution
- [ ] Implement scorer execution
- [ ] Implement parallel execution
- [ ] Implement span creation
- [ ] Implement result generation

## Phase 7: Examples

### examples/openai/
- [ ] Create openai_basic.rb
- [ ] Test example runs successfully

### examples/otel/
- [ ] Create otel_basic.rb
- [ ] Test example runs successfully

### examples/evals/
- [ ] Create eval_basic.rb
- [ ] Test example runs successfully

## Phase 8: Documentation & Polish

- [ ] Write comprehensive README.md
- [ ] Document all public APIs
- [ ] Add inline code comments
- [ ] Create CONTRIBUTING.md
- [ ] Create CHANGELOG.md
- [ ] Verify 80%+ test coverage
- [ ] Run Standard linter and fix issues
- [ ] Set up CI/CD pipeline
- [ ] Tag v0.1.0 release

## Current Status

**Last Updated**: 2025-10-21
**Current Phase**: Phase 1 (Project Setup) - Complete ✅
**Next Step**: Phase 2 - Core State & Configuration (TDD)
