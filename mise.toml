[settings]
experimental = true

[env]
_.file = ".env"

[tools]
ruby = "3.2"
rust = "1.83"
watchexec = "latest"

[tasks.lint]
run = "bundle exec rake lint"

[tasks."lint:fix"]
run = "bundle exec rake lint:fix"

[tasks."verify"]
run = "bundle exec rake lint test"

[tasks.watch-test]
description = "Runs tests when files change"
run = "watchexec --exts rb --watch lib --watch test --restart --clear -- rake test"

[tasks.precommit]
description = "Run linter before commit (full CI runs on push)"
run = """
bundle check || bundle install --quiet
if ! git diff --quiet --exit-code Gemfile.lock; then
  echo ""
  echo "Gemfile.lock is out of sync with gemspec"
  echo ""
  echo "Changes detected:"
  git diff Gemfile.lock | head -20
  echo ""
  echo "Fix: git add Gemfile.lock"
  exit 1
fi
bundle exec rake lint
"""

[hooks]
postinstall = """
echo "Installing gem dependencies..."
bundle install
echo "Setting up git pre-commit hook..."
mise generate git-pre-commit --write --task=precommit
"""
